<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>西班牙語字母練習</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 定義Inter字體，確保美觀 */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #a7e9af 0%, #87CEEB 100%); /* 柔和的漸變背景 */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden; /* 防止滾動條 */
        }
        .game-container {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 2rem; /* 圓潤的邊角 */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); /* 柔和的陰影 */
            padding: 2.5rem;
            width: 90%;
            max-width: 600px; /* 稍微增加最大寬度以容納更多按鈕 */
            text-align: center;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: fadeInScale 0.8s ease-out forwards; /* 淡入和放大動畫 */
        }

        /* 字母顯示區域 */
        .letter-display {
            font-size: 8rem; /* 巨大的字母 */
            font-weight: 700;
            color: #3b82f6; /* 清新藍色 */
            margin-bottom: 2rem;
            min-height: 150px; /* 確保足夠高度，避免內容跳動 */
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out; /* 字母過渡動畫 */
            opacity: 0; /* 初始隱藏 */
            transform: translateY(20px);
        }

        /* 字母進場動畫 */
        .letter-display.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* 主按鈕樣式 (重播一次, 下一個字母) */
        .btn {
            background-color: #60a5fa; /* 天藍色按鈕 */
            color: white;
            padding: 0.8rem 1.8rem;
            border-radius: 9999px; /* 超級圓潤的按鈕 */
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease, opacity 0.3s ease;
            box-shadow: 0 4px 15px rgba(96, 165, 250, 0.3); /* 按鈕陰影 */
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem; /* 統一按鈕字體大小 */
            flex-shrink: 0; /* 防止在小螢幕上收縮 */
        }

        .btn:hover:not(:disabled) { /* 禁用時不顯示hover效果 */
            background-color: #3b82f6; /* 深一點的藍色 */
            transform: translateY(-2px); /* 輕微上浮 */
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .btn:active:not(:disabled) { /* 禁用時不顯示active效果 */
            transform: translateY(0); /* 按下效果 */
            box-shadow: 0 2px 10px rgba(59, 130, 246, 0.2);
        }

        .btn:disabled { /* 禁用按鈕的樣式 */
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        /* 重播一次按鈕的特殊樣式 */
        #replayButton {
            background-color: #a7e9af; /* 淺綠色 */
            color: #22c55e; /* 深綠色文字 */
            box-shadow: 0 4px 15px rgba(167, 233, 175, 0.5);
            margin-bottom: 1.5rem;
            padding: 1rem 2.5rem;
        }
        #replayButton:hover:not(:disabled) {
            background-color: #86efac;
            box-shadow: 0 6px 20px rgba(134, 239, 172, 0.6);
        }

        /* 下一字母按鈕的特殊樣式 */
        #nextButton {
            margin-top: 1rem;
            background-color: #fca5a5; /* 淺紅色 */
            color: #ef4444; /* 深紅色文字 */
            box-shadow: 0 4px 15px rgba(252, 165, 165, 0.5);
        }
        #nextButton:hover:not(:disabled) {
            background-color: #ef4444;
            color: white;
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.6);
        }

        /* 新增的字母選擇區塊樣式 */
        .alphabet-choices {
            display: flex; /* 使用 flexbox 讓按鈕排成一行 */
            justify-content: center; /* 居中對齊 */
            gap: 1rem; /* 塊間距 */
            width: 100%;
            margin-top: 2rem; /* 與上方按鈕的間距 */
            padding: 1rem;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 1.5rem;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05); /* 內陰影 */
        }

        .choice-block { /* 命名為 choice-block 以區別 */
            background-color: #e0f2fe; /* 淺藍色背景 */
            color: #22a7f0; /* 藍色文字 */
            padding: 0.5rem;
            border-radius: 0.75rem; /* 圓潤邊角 */
            font-weight: 600;
            font-size: 1.5rem; /* 字母選擇塊的字體可以大一點 */
            width: 70px; /* 固定寬度 */
            height: 70px; /* 固定高度 */
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 2px solid transparent; /* 預留邊框空間 */
        }
        .choice-block:hover:not(:disabled) {
            background-color: #cce9fd; /* hover時顏色變深 */
            transform: translateY(-2px); /* 輕微上浮 */
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .choice-block:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 1px 5px rgba(0,0,0,0.08);
        }
        .choice-block.disabled { /* 禁用時的樣式 */
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        /* 答錯時的方塊效果 */
        .choice-block.incorrect-attempt {
            background-color: #fcebeb; /* 淺紅色背景 */
            border-color: #ef4444; /* 紅色邊框 */
            animation: shake 0.3s; /* 晃動動畫 */
        }

        /* 圓形裝飾元素 */
        .decorative-circle {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.3);
            filter: blur(20px); /* 柔和模糊效果 */
            z-index: -1;
            animation: float 10s infinite ease-in-out alternate; /* 浮動動畫 */
        }
        .circle-1 { top: -20px; left: -20px; width: 80px; height: 80px; animation-delay: 0s; }
        .circle-2 { bottom: -30px; right: -30px; width: 120px; height: 120px; animation-delay: 2s; }
        .circle-3 { top: 50%; left: -50px; width: 60px; height: 60px; animation-delay: 4s; }
        .circle-4 { bottom: -10px; left: 10%; width: 90px; height: 90px; animation-delay: 1s; }

        /* 動畫效果 */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes float {
            0% { transform: translate(0, 0); }
            50% { transform: translate(10px, 20px); }
            100% { transform: translate(0, 0); }
        }

        /* 加載指示器樣式 */
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3b82f6;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: none; /* 預設隱藏 */
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 語音播放時的字母光效 */
        .letter-display.playing {
            animation: glowPulse 1.2s infinite alternate;
        }

        @keyframes glowPulse {
            0% { text-shadow: 0 0 5px #fff, 0 0 10px #60a5fa; }
            100% { text-shadow: 0 0 10px #fff, 0 0 20px #3b82f6; }
        }

        /* 回饋訊息樣式 */
        #feedbackMessage {
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #4CAF50; /* 預設為綠色，正確訊息 */
            opacity: 0;
            transition: opacity 0.3s ease-out;
            min-height: 24px; /* 確保有足夠空間，避免佈局跳動 */
        }
        #feedbackMessage.show {
            opacity: 1;
        }
        #feedbackMessage.correct {
            color: #4CAF50; /* 綠色 */
        }
        #feedbackMessage.incorrect {
            color: #f44336; /* 紅色 */
        }

        /* 晃動動畫 */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- 裝飾性圓形元素 -->
        <div class="decorative-circle circle-1"></div>
        <div class="decorative-circle circle-2"></div>
        <div class="decorative-circle circle-3"></div>
        <div class="decorative-circle circle-4"></div>

        <h1 class="text-3xl font-bold text-gray-800 mb-6">西班牙語字母練習</h1>
        
        <!-- 加載指示器 -->
        <div id="loadingSpinner" class="loading-spinner"></div>

        <!-- 字母顯示區域 -->
        <div id="letterDisplay" class="letter-display"></div> <!-- 初始為空，將由JS設定 -->

        <!-- 回饋訊息 -->
        <p id="feedbackMessage"></p>

        <!-- 重播一次按鈕 -->
        <button id="replayButton" class="btn">
            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.121-9.193a8 8 0 010 11.314m-1.06-1.06l-4.243 4.243a1 1 0 01-1.414 0l-4.243-4.243a1 1 0 010-1.414l4.243-4.243a1 1 0 011.414 0l4.243 4.243a1 1 0 010 1.414z"></path></svg>
            重播一次
        </button>

        <!-- 下一字母按鈕 -->
        <button id="nextButton" class="btn mt-4">
            下一個字母
            <svg class="w-6 h-6 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>
        </button>

        <!-- 字母選擇區塊 -->
        <div id="alphabetChoicesContainer" class="alphabet-choices">
            <!-- 這三個字母方塊將由 JavaScript 動態生成 -->
        </div>
    </div>

    <script>
        // 獲取DOM元素
        const letterDisplay = document.getElementById('letterDisplay');
        const replayButton = document.getElementById('replayButton');
        const nextButton = document.getElementById('nextButton');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const alphabetChoicesContainer = document.getElementById('alphabetChoicesContainer'); // 字母選擇區塊容器
        const feedbackMessage = document.getElementById('feedbackMessage'); // 回饋訊息元素

        // 西班牙語字母表
        const spanishAlphabet = [
            'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M',
            'N', 'Ñ', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'
        ];
        let currentLetterIndex = 0; // 當前正在練習的字母在 spanishAlphabet 中的索引
        let speechSynth = window.speechSynthesis; // 語音合成API
        let spanishVoice = null; // 將儲存找到的西班牙語音色

        // 初始化語音合成器並選擇西班牙語音色
        function initializeSpeechSynth() {
            // 等待語音服務加載完畢
            speechSynth.onvoiceschanged = () => {
                const voices = speechSynth.getVoices();
                // 嘗試找到一個西班牙語(es-ES)的音色
                spanishVoice = voices.find(voice => voice.lang === 'es-ES' || voice.lang.startsWith('es-'));
                if (!spanishVoice) {
                    // 如果找不到，則嘗試使用任何可用的音色並給出警告
                    spanishVoice = voices.find(voice => voice.default); // 尋找預設音色
                    if (!spanishVoice) {
                        spanishVoice = voices[0]; // 退而求其次，使用第一個音色
                    }
                    console.warn("未找到es-ES西班牙語音色，將使用其他可用音色。發音可能不準確。");
                }
                
                // 遊戲初始化
                loadingSpinner.style.display = 'none'; // 隱藏加載指示器
                selectNewLetterAndSpeak(); // 隨機選擇第一個字母並開始遊戲
            };

            // 如果onvoiceschanged沒有觸發 (例如，聲音已經加載)，則手動檢查
            if (speechSynth.getVoices().length > 0) {
                speechSynth.onvoiceschanged(); // 強制觸發
            } else {
                // 如果還沒有聲音，顯示加載指示器
                loadingSpinner.style.display = 'block';
            }
        }

        // 隨機選擇一個新字母並開始發音
        function selectNewLetterAndSpeak() {
            // 隨機選擇下一個字母的索引
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * spanishAlphabet.length);
            } while (newIndex === currentLetterIndex && spanishAlphabet.length > 1); // 確保不是同一個字母，除非只有一個字母

            currentLetterIndex = newIndex;
            updateLetterDisplay(); // 更新主顯示區的字母和選項
            
            // 在字母顯示動畫結束後播放發音
            setTimeout(() => {
                speakLetter();
            }, 150);
        }

        // 更新字母顯示和按鈕狀態
        function updateLetterDisplay() {
            letterDisplay.classList.remove('active', 'playing'); // 移除舊的動畫類
            hideFeedbackMessage(); // 隱藏回饋訊息

            // 禁用所有互動按鈕直到字母載入完成並發音結束
            replayButton.disabled = true;
            nextButton.disabled = true;
            disableChoiceBlocks(true); // 禁用字母選擇區塊

            // 短暫延遲後更新內容並觸發進場動畫
            setTimeout(() => {
                const currentLetter = spanishAlphabet[currentLetterIndex];
                letterDisplay.textContent = currentLetter;
                letterDisplay.classList.add('active'); // 添加進場動畫類
                createChoiceBlocks(); // 每次更新字母時，重新生成選擇塊
            }, 100); // 100毫秒延遲
        }

        // 播放當前字母的發音
        function speakLetter() {
            if (!speechSynth) {
                console.error("瀏覽器不支持Web Speech API或語音服務未加載。");
                return;
            }

            // 在新的語音播放開始前，總是取消當前正在進行的語音
            if (speechSynth.speaking) {
                speechSynth.cancel();
            }
            
            // 禁用按鈕以防止發音中斷
            replayButton.disabled = true;
            nextButton.disabled = true;
            disableChoiceBlocks(true); // 發音時禁用字母選擇區塊

            const textToSpeak = letterDisplay.textContent;
            const utterance = new SpeechSynthesisUtterance(textToSpeak);

            utterance.lang = 'es-ES'; // 設定為西班牙語
            if (spanishVoice) {
                utterance.voice = spanishVoice; // 使用找到的西班牙語音色
            } else {
                console.warn("無法找到西班牙語音色，將使用默認音色進行發音。");
            }

            utterance.pitch = 1; // 音調
            utterance.rate = 0.8; // 語速稍微慢一點，以便聽清

            // 語音播放開始時添加光效
            utterance.onstart = () => {
                letterDisplay.classList.add('playing');
            };

            // 語音播放結束時移除光效並重新啟用相關按鈕
            utterance.onend = () => {
                letterDisplay.classList.remove('playing');
                replayButton.disabled = false; // 重播按鈕啟用
                nextButton.disabled = false; // 下一個字母按鈕啟用 (無論是否答對都可跳過)
                disableChoiceBlocks(false); // 啟用字母選擇區塊
            };

            // 語音播放錯誤處理
            utterance.onerror = (event) => {
                console.error('語音合成錯誤:', event.error);
                letterDisplay.classList.remove('playing');
                // 錯誤時也重新啟用按鈕，以便用戶繼續操作
                replayButton.disabled = false;
                nextButton.disabled = false;
                disableChoiceBlocks(false); // 啟用字母選擇區塊
            };

            speechSynth.speak(utterance);
        }

        // 生成3個字母選擇方塊，包含正確答案和2個隨機錯誤答案
        function createChoiceBlocks() {
            alphabetChoicesContainer.innerHTML = ''; // 清空現有區塊
            const correctLetter = spanishAlphabet[currentLetterIndex];
            const choices = [correctLetter]; // 正確答案

            // 生成2個不同的隨機錯誤答案
            while (choices.length < 3) {
                const randomIndex = Math.floor(Math.random() * spanishAlphabet.length);
                const randomLetter = spanishAlphabet[randomIndex];
                if (!choices.includes(randomLetter)) {
                    choices.push(randomLetter);
                }
            }

            // 打亂選項順序
            choices.sort(() => Math.random() - 0.5);

            choices.forEach(letter => {
                const block = document.createElement('button');
                block.textContent = letter;
                block.classList.add('choice-block');
                block.addEventListener('click', () => {
                    handleChoiceClick(block, letter);
                });
                alphabetChoicesContainer.appendChild(block);
            });
        }

        // 處理字母選擇方塊點擊
        function handleChoiceClick(clickedBlock, clickedLetter) {
            const correctLetter = spanishAlphabet[currentLetterIndex];

            if (clickedLetter === correctLetter) {
                showFeedbackMessage("太棒了！正確！", "correct");
                disableChoiceBlocks(true); // 禁用所有選項
                // 答對後自動跳到下一個字母
                setTimeout(() => {
                    selectNewLetterAndSpeak();
                }, 1000); // 顯示回饋1秒後跳轉
            } else {
                showFeedbackMessage("錯了，請再試一次！", "incorrect");
                clickedBlock.classList.add('incorrect-attempt'); // 添加錯誤提示動畫
                setTimeout(() => {
                    clickedBlock.classList.remove('incorrect-attempt'); // 移除動畫類以便下次使用
                }, 300);
            }
        }

        // 禁用/啟用字母選擇區塊
        function disableChoiceBlocks(disable) {
            document.querySelectorAll('.choice-block').forEach(block => {
                block.disabled = disable;
                if (disable) {
                    block.classList.add('disabled');
                } else {
                    block.classList.remove('disabled');
                    block.classList.remove('incorrect-attempt'); // 確保移除錯誤狀態
                }
            });
        }

        // 顯示回饋訊息
        function showFeedbackMessage(message, type) {
            feedbackMessage.textContent = message;
            feedbackMessage.className = ''; // 重置所有類名
            feedbackMessage.classList.add('show', type);
        }

        // 隱藏回饋訊息
        function hideFeedbackMessage() {
            feedbackMessage.classList.remove('show');
            feedbackMessage.textContent = ''; // 清空內容
        }

        // 事件監聽器
        replayButton.addEventListener('click', speakLetter);
        nextButton.addEventListener('click', selectNewLetterAndSpeak); // 直接調用選擇新字母的函數

        // 頁面加載完成時初始化
        document.addEventListener('DOMContentLoaded', initializeSpeechSynth);

    </script>
</body>
</html>
